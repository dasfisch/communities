/*!
  * Bean - copyright (c) Jacob Thornton 2011-2012
  * https://github.com/fat/bean
  * MIT license
  */
(function(e,t,n){if(typeof module!="undefined"&&module.exports)module.exports=n();else if(typeof define=="function"&&define.amd)define(n);else t[e]=n()})("bean",this,function(e,t){e=e||"bean";t=t||this;var n=window,r=t[e],i=/[^\.]*(?=\..*)\.|.*/,s=/\..*/,o="addEventListener",u="removeEventListener",a=document||{},f=a.documentElement||{},l=f[o],c=l?o:"attachEvent",h={},p=Array.prototype.slice,d=function(e,t){return e.split(t||" ")},v=function(e){return typeof e=="string"},m=function(e){return typeof e=="function"},g="click dblclick mouseup mousedown contextmenu "+"mousewheel mousemultiwheel DOMMouseScroll "+"mouseover mouseout mousemove selectstart selectend "+"keydown keypress keyup "+"orientationchange "+"focus blur change reset select submit focusout focusin "+"load unload beforeunload resize move DOMContentLoaded "+"readystatechange message "+"error abort scroll ",y="show "+"input invalid "+"touchstart touchmove touchend touchcancel "+"gesturestart gesturechange gestureend "+"textinput"+"readystatechange pageshow pagehide popstate "+"hashchange offline online "+"afterprint beforeprint "+"dragstart dragenter dragover dragleave drag drop dragend "+"loadstart progress suspend emptied stalled loadmetadata "+"loadeddata canplay canplaythrough playing waiting seeking "+"seeked ended durationchange timeupdate play pause ratechange "+"volumechange cuechange "+"checking noupdate downloading cached updateready obsolete ",b=function(e,t,n){for(n=0;n<t.length;n++)t[n]&&(e[t[n]]=1);return e}({},d(g+(l?y:""))),w=function(){var e="compareDocumentPosition"in f?function(e,t){return t.compareDocumentPosition&&(t.compareDocumentPosition(e)&16)===16}:"contains"in f?function(e,t){t=t.nodeType===9||t===window?f:t;return t!==e&&t.contains(e)}:function(e,t){while(e=e.parentNode)if(e===t)return 1;return 0},t=function(t){var n=t.relatedTarget;return!n?n==null:n!==this&&n.prefix!=="xul"&&!/document/.test(this.toString())&&!e(n,this)};return{mouseenter:{base:"mouseover",condition:t},mouseleave:{base:"mouseout",condition:t},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),E=function(){var e=d("altKey attrChange attrName bubbles cancelable ctrlKey currentTarget "+"detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey "+"srcElement target timeStamp type view which propertyName"),t=e.concat(d("button buttons clientX clientY dataTransfer "+"fromElement offsetX offsetY pageX pageY screenX screenY toElement")),r=t.concat(d("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ "+"axis")),i=e.concat(d("char charCode key keyCode keyIdentifier "+"keyLocation location")),s=e.concat(d("data")),o=e.concat(d("touches targetTouches changedTouches scale rotation")),u=e.concat(d("data origin source")),l=e.concat(d("state")),c=/over|out/,h=[{reg:/key/i,fix:function(e,t){t.keyCode=e.keyCode||e.which;return i}},{reg:/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,fix:function(e,n,r){n.rightClick=e.which===3||e.button===2;n.pos={x:0,y:0};if(e.pageX||e.pageY){n.clientX=e.pageX;n.clientY=e.pageY}else if(e.clientX||e.clientY){n.clientX=e.clientX+a.body.scrollLeft+f.scrollLeft;n.clientY=e.clientY+a.body.scrollTop+f.scrollTop}if(c.test(r)){n.relatedTarget=e.relatedTarget||e[(r=="mouseover"?"from":"to")+"Element"]}return t}},{reg:/mouse.*(wheel|scroll)/i,fix:function(){return r}},{reg:/^text/i,fix:function(){return s}},{reg:/^touch|^gesture/i,fix:function(){return o}},{reg:/^message$/i,fix:function(){return u}},{reg:/^popstate$/i,fix:function(){return l}},{reg:/.*/,fix:function(){return e}}],p={},v=function(e,t,r){if(!arguments.length)return;e=e||((t.ownerDocument||t.document||t).parentWindow||n).event;this.originalEvent=e;this.isNative=r;this.isBean=true;if(!e)return;var i=e.type,s=e.target||e.srcElement,o,u,a,f,l;this.target=s&&s.nodeType===3?s.parentNode:s;if(r){l=p[i];if(!l){for(o=0,u=h.length;o<u;o++){if(h[o].reg.test(i)){p[i]=l=h[o].fix;break}}}f=l(e,this,i);for(o=f.length;o--;){if(!((a=f[o])in this)&&a in e)this[a]=e[a]}}};v.prototype.preventDefault=function(){if(this.originalEvent.preventDefault)this.originalEvent.preventDefault();else this.originalEvent.returnValue=false};v.prototype.stopPropagation=function(){if(this.originalEvent.stopPropagation)this.originalEvent.stopPropagation();else this.originalEvent.cancelBubble=true};v.prototype.stop=function(){this.preventDefault();this.stopPropagation();this.stopped=true};v.prototype.stopImmediatePropagation=function(){if(this.originalEvent.stopImmediatePropagation)this.originalEvent.stopImmediatePropagation();this.isImmediatePropagationStopped=function(){return true}};v.prototype.isImmediatePropagationStopped=function(){return this.originalEvent.isImmediatePropagationStopped&&this.originalEvent.isImmediatePropagationStopped()};v.prototype.clone=function(e){var t=new v(this,this.element,this.isNative);t.currentTarget=e;return t};return v}(),S=function(e,t){return!l&&!t&&(e===a||e===n)?f:e},x=function(){var e=function(e,t,n,r){var i=function(n,i){return t.apply(e,r?p.call(i,n?0:1).concat(r):i)},s=function(n,r){return t.__beanDel?t.__beanDel.ft(n.target,e):r},o=n?function(e){var t=s(e,this);if(n.apply(t,arguments)){if(e)e.currentTarget=t;e.data=r;return i(e,arguments)}}:function(e){if(t.__beanDel){e=e.clone(s(e))}e.data=r;return i(e,arguments)};o.__beanDel=t.__beanDel;return o},t=function(t,n,r,i,s,o,u){var a=w[n],f;if(n=="unload"){r=A(O,t,n,r,i)}if(a){if(a.condition){r=e(t,r,a.condition,o)}n=a.base||n}this.isNative=f=b[n]&&!!t[c];this.customType=!l&&!f&&n;this.element=t;this.type=n;this.original=i;this.namespaces=s;this.eventType=l||f?n:"propertychange";this.target=S(t,f);this[c]=!!this.target[c];this.root=u;this.handler=e(t,r,null,o)};t.prototype.inNamespaces=function(e){var t,n,r=0;if(!e)return true;if(!this.namespaces)return false;for(t=e.length;t--;){for(n=this.namespaces.length;n--;){if(e[t]==this.namespaces[n])r++}}return e.length===r};t.prototype.matches=function(e,t,n){return this.element===e&&(!t||this.original===t)&&(!n||this.handler===n)};return t}(),T=function(){var e={},t=function(n,r,i,s,o,u){var a=o?"r":"$";if(!r||r=="*"){for(var f in e){if(f.charAt(0)==a){t(n,f.substr(1),i,s,o,u)}}}else{var l=0,c,h=e[a+r],p=n=="*";if(!h)return;for(c=h.length;l<c;l++){if((p||h[l].matches(n,i,s))&&!u(h[l],h,l,r))return}}},n=function(t,n,r,i){var s,o=e[(i?"r":"$")+n];if(o){for(s=o.length;s--;){if(!o[s].root&&o[s].matches(t,r,null))return true}}return false},r=function(e,n,r,i){var s=[];t(e,n,r,null,i,function(e){return s.push(e)});return s},i=function(t){var n=!t.root&&!this.has(t.element,t.type,null,false),r=(t.root?"r":"$")+t.type;(e[r]||(e[r]=[])).push(t);return n},s=function(n){t(n.element,n.type,null,n.handler,n.root,function(t,n,r){n.splice(r,1);t.removed=true;if(n.length===0)delete e[(t.root?"r":"$")+t.type];return false})},o=function(){var t,n=[];for(t in e){if(t.charAt(0)=="$")n=n.concat(e[t])}return n};return{has:n,get:r,put:i,del:s,entries:o}}(),N,C=function(e){if(!arguments.length){N=a.querySelectorAll?function(e,t){return t.querySelectorAll(e)}:function(){throw new Error("Bean: No selector engine installed")}}else{N=e}},k=function(e,t){if(!l&&t&&e&&e.propertyName!="_on"+t)return;var n=T.get(this,t||e.type,null,false),r=n.length,i=0;e=new E(e,this,true);if(t)e.type=t;for(;i<r&&!e.isImmediatePropagationStopped();i++){if(!n[i].removed)n[i].handler.call(this,e)}},L=l?function(e,t,n,r,i){e[n?o:u](t,k,i)}:function(e,t,n,r){var i;if(n){T.put(i=new x(e,r||t,function(t){k.call(e,t,r)},k,null,null,true));if(r&&e["_on"+r]==null)e["_on"+r]=0;i.target.attachEvent("on"+i.eventType,i.handler)}else{i=T.get(e,r||t,k,true)[0];if(i){i.target.detachEvent("on"+i.eventType,i.handler);T.del(i)}}},A=function(e,t,n,r,i){return function(){r.apply(this,arguments);e(t,n,i)}},O=function(e,t,n,r){var i=t&&t.replace(s,""),o=T.get(e,i,null,false),u={},a,f;for(a=0,f=o.length;a<f;a++){if((!n||o[a].original===n)&&o[a].inNamespaces(r)){T.del(o[a]);if(!u[o[a].eventType]&&o[a][c])u[o[a].eventType]={t:o[a].eventType,c:o[a].type}}}for(a in u){if(!T.has(e,u[a].t,null,false)){L(e,u[a].t,false,u[a].c)}}},M=function(e,t){var n=function(t,n){var r,i=v(e)?N(e,n):e;for(;t&&t!==n;t=t.parentNode){for(r=i.length;r--;){if(i[r]===t)return t}}},r=function(e){var r=n(e.target,this);if(r)t.apply(r,arguments)};r.__beanDel={ft:n,selector:e};return r},_=l?function(e,t,r){var i=a.createEvent(e?"HTMLEvents":"UIEvents");i[e?"initEvent":"initUIEvent"](t,true,true,n,1);r.dispatchEvent(i)}:function(e,t,n){n=S(n,e);e?n.fireEvent("on"+t,a.createEventObject()):n["_on"+t]++},D=function(e,t,n){var r=v(t),o,u,a,f;if(r&&t.indexOf(" ")>0){t=d(t);for(f=t.length;f--;)D(e,t[f],n);return e}u=r&&t.replace(s,"");if(u&&w[u])u=w[u].base;if(!t||r){if(a=r&&t.replace(i,""))a=d(a,".");O(e,u,n,a)}else if(m(t)){O(e,null,t)}else{for(o in t){if(t.hasOwnProperty(o))D(e,o,t[o])}}return e},P=function(e,t,n,r,o){var u,a,f,l,v,g,y,b;capt=r||false;if(n===undefined&&typeof t=="object"){for(a in t){if(t.hasOwnProperty(a)){P.call(this,e,a,t[a])}}return}if(!m(n)){if(typeof n==="boolean"){v=p.call(arguments,4);o=u=r;b=n}else if(!m(r)){u=o;v=p.call(arguments,5);o=M(n,u,N);b=r}else{u=r;v=p.call(arguments,4);o=M(n,u,N);b=false}}else{v=p.call(arguments,3);o=u=n}f=d(t);if(this===h){o=A(D,e,t,o,u)}for(l=f.length;l--;){y=T.put(g=new x(e,f[l].replace(s,""),o,u,d(f[l].replace(i,""),"."),v,false));if(g[c]&&y){L(e,g.eventType,true,g.customType,b)}}return e},H=function(e,t,n,r){return P.apply(null,!v(n)?p.call(arguments):[e,n,t,r].concat(arguments.length>3?p.call(arguments,5):[]))},B=function(){return P.apply(h,arguments)},j=function(e,t,n){var r=d(t),o,u,a,f,l;for(o=r.length;o--;){t=r[o].replace(s,"");if(f=r[o].replace(i,""))f=d(f,".");if(!f&&!n&&e[c]){_(b[t],t,e)}else{l=T.get(e,t,null,false);n=[false].concat(n);for(u=0,a=l.length;u<a;u++){if(l[u].inNamespaces(f)){l[u].handler.apply(e,n)}}}}return e},F=function(e,t,n){var r=T.get(t,n,null,false),i=r.length,s=0,o,u;for(;s<i;s++){if(r[s].original){o=[e,r[s].type];if(u=r[s].handler.__beanDel)o.push(u.selector);o.push(r[s].original);P.apply(null,o)}}return e},I={on:P,add:H,one:B,off:D,remove:D,clone:F,fire:j,setSelectorEngine:C,noConflict:function(){t[e]=r;return this}};if(n.attachEvent){var q=function(){var e,t=T.entries();for(e in t){if(t[e].type&&t[e].type!=="unload")D(t[e].element,t[e].type)}n.detachEvent("onunload",q);n.CollectGarbage&&n.CollectGarbage()};n.attachEvent("onunload",q)}C();return I})